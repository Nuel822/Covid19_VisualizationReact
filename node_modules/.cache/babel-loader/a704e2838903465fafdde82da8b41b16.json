{"ast":null,"code":"import { deepMix, isString, map, size } from '@antv/util';\nimport { DIRECTION } from '../constant';\nimport { getMappingValue } from './attr';\nimport { MarkerSymbols } from './marker';\n/**\n * @ignore\n * get the legend layout from direction\n * @param direction\n * @returns layout 'horizontal' | 'vertical'\n */\n\nexport function getLegendLayout(direction) {\n  return direction.startsWith(DIRECTION.LEFT) || direction.startsWith(DIRECTION.RIGHT) ? 'vertical' : 'horizontal';\n}\n/**\n * @ignore\n * get the legend items\n * @param view\n * @param geometry\n * @param attr\n * @param themeMarker\n * @param userMarker\n * @returns legend items\n */\n\nexport function getLegendItems(view, geometry, attr, themeMarker, userMarker) {\n  var scale = attr.getScale(attr.type);\n\n  if (scale.isCategory) {\n    var field_1 = scale.field;\n    return map(scale.getTicks(), function (tick) {\n      var _a;\n\n      var text = tick.text,\n          scaleValue = tick.value;\n      var name = text;\n      var value = scale.invert(scaleValue); // 通过过滤图例项的数据，来看是否乣 unchecked\n\n      var unchecked = !size(view.filterFieldData(field_1, [(_a = {}, _a[field_1] = value, _a)]));\n      var colorAttr = geometry.getAttribute('color');\n      var shapeAttr = geometry.getAttribute('shape'); // @ts-ignore\n\n      var color = getMappingValue(colorAttr, value, view.getTheme().defaultColor);\n      var shape = getMappingValue(shapeAttr, value, 'point');\n      var marker = geometry.getShapeMarker(shape, {\n        color: color,\n        isInPolar: geometry.coordinate.isPolar\n      }); // the marker configure order should be ensure\n\n      marker = deepMix({}, themeMarker, marker, userMarker);\n      var symbol = marker.symbol;\n\n      if (isString(symbol) && MarkerSymbols[symbol]) {\n        marker.symbol = MarkerSymbols[symbol];\n      }\n\n      return {\n        id: value,\n        name: name,\n        value: value,\n        marker: marker,\n        unchecked: unchecked\n      };\n    });\n  }\n\n  return [];\n}\n/**\n * @ignore\n * custom legend 的 items 获取\n * @param themeMarker\n * @param userMarker\n * @param customItems\n */\n\nexport function getCustomLegendItems(themeMarker, userMarker, customItems) {\n  // 如果有自定义的 item，那么就直接使用，并合并主题的 marker 配置\n  return map(customItems, function (item) {\n    var marker = deepMix({}, themeMarker, userMarker, item.marker);\n    var symbol = marker.symbol;\n\n    if (isString(symbol) && MarkerSymbols[symbol]) {\n      marker.symbol = MarkerSymbols[symbol];\n    }\n\n    item.marker = marker;\n    return item;\n  });\n}","map":{"version":3,"sources":["../../src/util/legend.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { deepMix, isString, map, size } from '@antv/util';\nimport { DIRECTION } from '../constant';\nimport { getMappingValue } from './attr';\nimport { MarkerSymbols } from './marker';\n/**\n * @ignore\n * get the legend layout from direction\n * @param direction\n * @returns layout 'horizontal' | 'vertical'\n */\nexport function getLegendLayout(direction) {\n    return direction.startsWith(DIRECTION.LEFT) || direction.startsWith(DIRECTION.RIGHT) ? 'vertical' : 'horizontal';\n}\n/**\n * @ignore\n * get the legend items\n * @param view\n * @param geometry\n * @param attr\n * @param themeMarker\n * @param userMarker\n * @returns legend items\n */\nexport function getLegendItems(view, geometry, attr, themeMarker, userMarker) {\n    var scale = attr.getScale(attr.type);\n    if (scale.isCategory) {\n        var field_1 = scale.field;\n        return map(scale.getTicks(), function (tick) {\n            var _a;\n            var text = tick.text, scaleValue = tick.value;\n            var name = text;\n            var value = scale.invert(scaleValue);\n            // 通过过滤图例项的数据，来看是否乣 unchecked\n            var unchecked = !size(view.filterFieldData(field_1, [(_a = {}, _a[field_1] = value, _a)]));\n            var colorAttr = geometry.getAttribute('color');\n            var shapeAttr = geometry.getAttribute('shape');\n            // @ts-ignore\n            var color = getMappingValue(colorAttr, value, view.getTheme().defaultColor);\n            var shape = getMappingValue(shapeAttr, value, 'point');\n            var marker = geometry.getShapeMarker(shape, {\n                color: color,\n                isInPolar: geometry.coordinate.isPolar,\n            });\n            // the marker configure order should be ensure\n            marker = deepMix({}, themeMarker, marker, userMarker);\n            var symbol = marker.symbol;\n            if (isString(symbol) && MarkerSymbols[symbol]) {\n                marker.symbol = MarkerSymbols[symbol];\n            }\n            return { id: value, name: name, value: value, marker: marker, unchecked: unchecked };\n        });\n    }\n    return [];\n}\n/**\n * @ignore\n * custom legend 的 items 获取\n * @param themeMarker\n * @param userMarker\n * @param customItems\n */\nexport function getCustomLegendItems(themeMarker, userMarker, customItems) {\n    // 如果有自定义的 item，那么就直接使用，并合并主题的 marker 配置\n    return map(customItems, function (item) {\n        var marker = deepMix({}, themeMarker, userMarker, item.marker);\n        var symbol = marker.symbol;\n        if (isString(symbol) && MarkerSymbols[symbol]) {\n            marker.symbol = MarkerSymbols[symbol];\n        }\n        item.marker = marker;\n        return item;\n    });\n}\n//# sourceMappingURL=legend.js.map"]},"metadata":{},"sourceType":"module"}